{
    "version": 3,
    "sources": [
        "..\\..\\..\\..\\src\\admin\\controller\\system\\usergroup.js"
    ],
    "names": [],
    "mappings": "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",
    "file": "..\\..\\..\\..\\src\\admin\\controller\\system\\usergroup.js",
    "sourcesContent": [
        "'use strict';\n\nimport Base from '../base.js';\n\nexport default class extends Base {\n  /**\n   * index action\n   * @return {Promise} []\n   */\n  async indexAction(){\n    //auto render template file index_index.html\n    let page_index=this.get(\"page\");\n    let name=this.get(\"name\");\n    let search={};\n    if(name&&name.length>0){\n      search.name=['like','%'+name+'%'];\n    }\n    this.assign(\"name\",name);\n    if(!page_index) page_index=1;\n    let page_count=10;\n    let model=this.model(\"usergroup\");\n\n    let raw_data=await model.page(page_index,page_count).where(search).countSelect();\n    this.assign(\"usergroups\",raw_data.data);\n    this.assign(\"currentPage\",raw_data.currentPage);\n    this.assign(\"itemsCount\",raw_data.count);\n    this.assign(\"totalPages\",raw_data.totalPages);\n    this.assign(\"startPage\",(page_index-1)*page_count+1);\n    this.assign(\"endPage\",Math.min(page_index*page_count,raw_data.count));\n    return this.display();\n  }\n  /**\n  * update action\n  * 更新\n  * @return {Promise} []\n  */\n  async updateAction(){\n    if(this.isGet()){\n      // let csrf=await this.session(\"__CSRF__\");\n      // this.assign(\"csrf\",csrf);\n      let id=this.get(\"id\");\n      let model=this.model(\"usergroup\");\n      let data=await model.where({id:id}).find();\n      this.assign(\"usergroup\",data);\n      return this.display();\n    }else{\n      let name=this.post(\"name\"),deleted=!!this.post(\"deleted\"),id=this.post(\"id\");\n\n      let updatedat=new Date();\n      let to_update={name:name,deleted:deleted,updatedat:updatedat.toLocaleString()}\n\n      //插入数据\n      let model=this.model(\"usergroup\");\n\n      await model.where({id:id}).update(to_update);\n      return this.redirect(\"/system/usergroup/index\");\n    }\n  }\n\n  /**\n  * insert action\n  * 插入\n  * @return {Promise} []\n  */\n  async insertAction(){\n    if(this.isGet()){\n      return this.display();\n    }\n    let name=this.post(\"name\"),deleted=!!this.post(\"deleted\");\n    let uuid=require('uuid');\n\n    //插入数据\n    let model=this.model(\"usergroup\");\n    let createdat=new Date();\n    let updatedat=new Date();\n\n    await model.add({\n      name:name,\n      deleted:deleted,\n      createdat:createdat.toLocaleString(),\n      updatedat:updatedat.toLocaleString(),\n      uuid:uuid.v4().toString()\n    });\n    return this.redirect(\"/system/usergroup/index\");\n  }\n\n  /**\n  * delete action\n  * 删除\n  * @return {Promise} []\n  */\n  async deleteAction(){\n    if(this.isGet()){\n      this.assign(\"id\",this.get(\"id\"));\n      return this.display();\n    }\n    let id=this.post(\"id\");\n    let model=this.model(\"usergroup\");\n    await model.where({id:id}).delete();\n    return this.redirect(\"/system_usergroup\");\n  }\n\n  async menuAction(){\n    if(this.isGet()){\n      let uuid=this.get(\"uuid\");\n      let sql=`select a.id,a.uuid,a.\"name\",a.deleted,b.id as usergroup_menu_id,b.uuid as usergroup_menu_uuid from menu a\n\t\t\tleft join (select * from usergroup_menu where usergroup_uuid='`+uuid+`') b on a.uuid=b.menu_uuid`;\n      let model=this.model(\"menu\");\n      let data=model.query(sql);\n      this.assign(\"menus\",data);\n      this.assign(\"uuid\",uuid);\n      return this.display();\n    }else{\n      let selected_uuid=this.post(\"selected_uuid\");\n\n      if( typeof(selected_uuid)==='string'&&selected_uuid.length>0){\n        selected_uuid=[selected_uuid];\n      }\n      let usergroup_uuid=this.post(\"uuid\");\n      let model=this.model(\"usergroup_menu\");\n      await model.where({usergroup_uuid:usergroup_uuid}).delete();\n      let to_add=[];\n      let uuid=require('uuid');\n      let createdat=new Date();\n\n\n\n      for(let i=0;i<selected_uuid.length;i++){\n        to_add.push({\n          uuid:uuid.v4().toString(),\n          usergroup_uuid:usergroup_uuid,\n          menu_uuid:selected_uuid[i],\n          deleted:false,\n          createdat:createdat.toLocaleString(),\n          updatedat:createdat.toLocaleString()\n        });\n      }\n      if(to_add.length>0){\n        await model.addMany(to_add);\n      }\n\n      return this.redirect('/system/usergroup/index');\n    }\n  }\n}\n"
    ]
}