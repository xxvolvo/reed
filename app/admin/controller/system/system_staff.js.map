{
    "version": 3,
    "sources": [
        "..\\..\\..\\..\\src\\admin\\controller\\system\\system_staff.js"
    ],
    "names": [],
    "mappings": "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",
    "file": "..\\..\\..\\..\\src\\admin\\controller\\system\\system_staff.js",
    "sourcesContent": [
        "'use strict';\n\nimport Base from './base.js';\n\nexport default class extends Base {\n  /**\n   * index action\n   * @return {Promise} []\n   */\n  async indexAction(){\n    //auto render template file index_index.html\n    let page_index=this.get(\"page\");\n    let name=this.get(\"name\");\n    let search={};\n    if(name&&name.length>0){\n      search.name=['like','%'+name+'%'];\n    }\n    this.assign(\"name\",name);\n    if(!page_index) page_index=1;\n    let page_count=10;\n    let model=this.model(\"v_staff\");\n\n    let raw_data=await model.page(page_index,page_count).where(search).countSelect();\n    this.assign(\"staffs\",raw_data.data);\n    this.assign(\"currentPage\",raw_data.currentPage);\n    this.assign(\"itemsCount\",raw_data.count);\n    this.assign(\"totalPages\",raw_data.totalPages);\n    this.assign(\"startPage\",(page_index-1)*page_count+1);\n    this.assign(\"endPage\",Math.min(page_index*page_count,raw_data.count));\n    return this.display();\n  }\n  /**\n  * update action\n  * 更新\n  * @return {Promise} []\n  */\n  async updateAction(){\n    if(this.isGet()){\n      // let csrf=await this.session(\"__CSRF__\");\n      // this.assign(\"csrf\",csrf);\n      let id=this.get(\"id\");\n      let model=this.model(\"staff\");\n      let data=await model.where({id:id}).find();\n      let model_dept=this.model(\"department\");\n      let data_dept=model_dept.order(\"name\").select();\n      let model_ug=this.model('usergroup');\n      let data_ug=model_ug.order(\"name\").select();\n\n      this.assign(\"depts\",data_dept);\n      this.assign(\"usergroups\",data_ug);\n      this.assign(\"staff\",data);\n      return this.display();\n    }else{\n      let name=this.post(\"name\"),deleted=!!this.post(\"deleted\"),id=this.post(\"id\"),password=this.post(\"password\"),dept_uuid=this.post(\"dept_uuid\"),usergroup_uuid=this.post(\"usergroup_uuid\");\n\n\n      let updatedat=new Date();\n      let to_update={name:name,deleted:deleted,updatedat:updatedat.toLocaleString(),dept_uuid:dept_uuid,usergroup_uuid:usergroup_uuid}\n\n      if(password&&password.length>0){\n        let crypto=require('crypto');\n        var md5sum = crypto.createHash('md5');\n        md5sum.update(password);\n        let pwd = md5sum.digest('hex');\n        to_update.pwd_hash=pwd;\n      }\n      //插入数据\n      let model=this.model(\"staff\");\n\n      await model.where({id:id}).update(to_update);\n      return this.redirect(\"/system_staff\");\n    }\n  }\n\n  /**\n  * insert action\n  * 插入\n  * @return {Promise} []\n  */\n  async insertAction(){\n    if(this.isGet()){\n      let model=this.model(\"department\");\n      let data=model.order(\"name\").select();\n      let model_ug=this.model('usergroup');\n      let data_ug=model_ug.order(\"name\").select();\n\n      this.assign(\"depts\",data);\n      this.assign(\"usergroups\",data_ug);\n      return this.display();\n    }\n    let name=this.post(\"name\"),deleted=!!this.post(\"deleted\"),password=this.post(\"password\"),dept_uuid=this.post(\"dept_uuid\"),usergroup_uuid=this.post(\"usergroup_uuid\");\n    let crypto=require('crypto');\n    var md5sum = crypto.createHash('md5');\n    md5sum.update(password);\n    let pwd = md5sum.digest('hex');\n    let uuid=require('uuid');\n\n    //插入数据\n    let model=this.model(\"staff\");\n    let createdat=new Date();\n    let updatedat=new Date();\n\n    await model.add({\n      name:name,\n      pwd_hash:pwd,\n      dept_uuid:dept_uuid,\n      usergroup_uuid:usergroup_uuid,\n      deleted:deleted,\n      createdat:createdat.toLocaleString(),\n      updatedat:updatedat.toLocaleString(),\n      uuid:uuid.v4().toString()\n    });\n    return this.redirect(\"/system_staff\");\n  }\n\n  /**\n  * delete action\n  * 删除\n  * @return {Promise} []\n  */\n  async deleteAction(){\n    if(this.isGet()){\n      this.assign(\"id\",this.get(\"id\"));\n      return this.display();\n    }\n    let id=this.post(\"id\");\n    let model=this.model(\"staff\");\n    await model.where({id:id}).delete();\n    return this.redirect(\"/system_staff\");\n  }\n}\n"
    ]
}