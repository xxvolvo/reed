{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\admin\\controller\\cmdt_brand.js"
    ],
    "names": [],
    "mappings": "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",
    "file": "..\\..\\..\\src\\admin\\controller\\cmdt_brand.js",
    "sourcesContent": [
        "'use strict';\n\nimport Base from './base.js';\n\nexport default class extends Base {\n  /**\n  * index action\n  * @return {Promise} []\n  */\n  async indexAction(){\n    //auto render template file index_index.html\n    let page_index=this.get(\"page\");\n    let name=this.get(\"name\");\n    let search={};\n    if(name&&name.length>0){\n      search.name=['like','%'+name+'%'];\n    }\n    this.assign(\"name\",name);\n    if(!page_index) page_index=1;\n    let page_count=10;\n    console.log(page_count);\n    console.log(this.config.nums_per_page);\n    let model=this.model(\"brand\");\n\n    let raw_data=await model.page(page_index,page_count).where(search).countSelect();\n    this.assign(\"brands\",raw_data.data);\n    this.assign(\"currentPage\",raw_data.currentPage);\n    this.assign(\"itemsCount\",raw_data.count);\n    this.assign(\"totalPages\",raw_data.totalPages);\n    this.assign(\"startPage\",(page_index-1)*page_count+1);\n    this.assign(\"endPage\",Math.min(page_index*page_count,raw_data.count));\n    return this.display();\n  }\n\n  async selectAction(){\n    let model=this.model(\"brand\");\n    let data=await model.select();\n    return this.success(data);\n  }\n  async updateAction(){\n    if(this.isGet()){\n      // let csrf=await this.session(\"__CSRF__\");\r\n      // this.assign(\"csrf\",csrf);\n      var id=this.get(\"id\");\n      var model=this.model(\"brand\");\n      var data=await model.where({id:id}).find();\n      this.assign(\"brand\",data);\n      return this.display();\n    }else{\n      let name=this.post(\"name\"),desc=this.post(\"desc\"),deleted=!!this.post(\"deleted\"),id=this.post(\"id\");\n\n      var updatedat=new Date();\n      var to_update={name:name,description:desc,deleted:deleted,updatedat:updatedat.toLocaleString()}\n      let file=this.file(\"pic_url\");\n\n      if(file.size){\n        //处理图片\n        var fs=require('fs');\n        var util=require('util');\n        var imgname=Date.parse(new Date())+\".jpg\";\n        var path=require('path');\n        var full_img_name=path.join(__dirname,'../../../www/static/user_images/brand',imgname);\n        var pic_url=\"/static/user_images/brand/\"+imgname;\n\n        var is=fs.createReadStream(file.path);\n        var os=fs.createWriteStream(full_img_name);\n        await util.pump(is,os);\n        fs.unlinkSync(file.path);\n        to_update.pic_url=pic_url;\n      }\n\n      //插入数据\n      var model=this.model(\"brand\");\n\n      await model.where({id:id}).update(to_update);\n      let http=this.http;\n      return http.redirect(\"/cmdt_brand\");\n    }\n  }\n\n  async insertAction(){\n    if(this.isGet()){\n      return this.display();\n    }\n    let name=this.post(\"name\"),desc=this.post(\"desc\"),deleted=!!this.post(\"deleted\");\n\n    //上传图片\n    var uuid=require('uuid');\n    let file=this.file(\"pic_url\");\n    var path=require('path');\n    var extname=path.extname(file.originalFilename);\n    var qiniu=require('../../common/util/qiniu-yun.js');\n    var imgname=uuid.v4().toString()+extname;\n    var pic_url='static/user_images/brand/'+imgname;\n    var upload_result=await qiniu.upload(file.path,pic_url);\n    var config=think.config('app').qiniu;\n    pic_url=config.domain+\"/\"+pic_url;\n    //插入数据\n    var model=this.model(\"brand\");\n    var createdat=new Date();\n    var updatedat=new Date();\n\n\n    await model.add({name:name,description:desc,deleted:deleted,createdat:createdat.toLocaleString(),updatedat:updatedat.toLocaleString(),pic_url:pic_url,uuid:uuid.v4().toString()});\n    return this.redirect(\"/cmdt_brand\");\n  }\n\n  async deleteAction(){\n    if(this.isGet()){\n      this.assign(\"id\",this.get(\"id\"));\n      return this.display();\n    }\n    let id=this.post(\"id\");\n    let model=this.model(\"brand\");\n    await model.where({id:id}).delete();\n    let http=this.http;\n    return http.redirect(\"/cmdt_brand\");\n  }\n}\n"
    ]
}