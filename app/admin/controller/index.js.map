{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\admin\\controller\\index.js"
    ],
    "names": [],
    "mappings": "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",
    "file": "..\\..\\..\\src\\admin\\controller\\index.js",
    "sourcesContent": [
        "'use strict';\n\nimport Base from './base.js';\n\nexport default class extends Base {\n\n  /**\n   * index action\n   * @return {Promise} []\n   */\n  async indexAction(){\n    let now_user=await this.session(\"now_user\");\n    //console.log(now_user);\n    if(think.isEmpty(now_user)){\n      return this.redirect(\"/index/login\");\n    }\n    //auto render template file index_index.html\n    let user_uuid=now_user.uuid;\n    //查找员工\n    let model_user=this.model(\"staff\");\n    let data_user=await model_user.where({uuid:user_uuid}).find();\n    //查找用户组中记录的菜单\n    let model_usergroup_menu=this.model(\"usergroup_menu\");\n    let data_usergroup_menu=await model_usergroup_menu.where({usergroup_uuid:data_user.usergroup_uuid}).select();\n    //查找菜单\n    let model_menu=this.model(\"menu\");\n    let menu_uuids=[];\n    for(let key in data_usergroup_menu){\n      menu_uuids.push(data_usergroup_menu[key].menu_uuid);\n    }\n    let data_menu=await model_menu.where({uuid:[\"in\",menu_uuids]}).order(\"sort_num\").select();\n\n    let parent_before_str=`<li class=\"treeview\">\n      <a href=\"#\"><i class=\"fa fa-{{icon}}\"></i><span>{{name}}</span> <i class=\"fa fa-angle-left pull-right\"></i></a>\n      <ul class=\"treeview-menu\">`;\n    let parent_after_str=`</ul>\n  </li>`;\n    let alone_str=`<li><a href=\"javascript:$.Reed.router.link('{{href}}','{{controller}}','{{name}}')\" ><i class=\"fa fa-{{icon}}\"></i><span>{{name}}</span></a></li>`;\n\n    let tohtml=function(one,list){\n      var html='';\n      //判断有无子元素\n      let has_child=false;\n      for(let j=0;j<list.length;j++){\n        if(list[j].puuid==one.uuid){\n          has_child=true;\n          break;\n        }\n      }\n      if(has_child){\n        html+=parent_before_str.replace(\"{{icon}}\",one.icon).replace(\"{{name}}\",one.name);\n        for(let i=0;i<list.length;i++){\n          if(list[i].puuid==one.uuid){\n            html+=tohtml(list[i],list);\n          }\n        }\n        html+=parent_after_str;\n      }else{\n        html+=alone_str.replace(\"{{href}}\",one.href).replace(\"{{controller}}\",one.controller).replace(\"{{name}}\",one.name).replace(\"{{name}}\",one.name).replace(\"{{icon}}\",one.icon);\n      }\n      return html;\n    };\n\n    let final_html='';\n    for(let i=0;i<data_menu.length;i++){\n      if(data_menu[i].puuid==null){\n        final_html+=tohtml(data_menu[i],data_menu);\n      }\n    }\n    this.assign('menu',final_html);\n    this.assign(\"user\",now_user);\n    return this.display();\n  }\n\n  async loginAction(){\n    if(this.isPost()){\n      let name=this.post(\"name\").trim(),\n          password=this.post(\"pwd\").trim();\n      let csrf = this.config('icsrf');\n      let value = await this.session(csrf.session_name);\n      this.assign(\"csrf\",value);\n      if(!name||name.length==0||!password||password.length==0){\n        this.assign(\"message\",'请输入用户名和密码');\n        return this.display();\n      }\n      let model=this.model(\"staff\");\n      let crypto=require('crypto');\n      var md5sum = crypto.createHash('md5');\n      md5sum.update(password);\n      let pwd = md5sum.digest('hex');\n\n      let data=await model.where({name:name,pwd_hash:pwd}).find();\n      console.log(data);\n      if(!data||think.isEmpty(data)){\n        this.assign(\"message\",'用户名密码不正确');\n        return this.display();\n      }\n      this.session(\"now_user\",data);\n      return this.redirect(\"/\");\n    }else{\n      this.assign(\"message\",'');\n      return this.display();\n    }\n  }\n  async logoutAction(){\n    this.session();\n    return this.redirect(\"/index/login\");\n  }\n  async testAction(){\n    let model=this.model(\"menu\");\n    let data=await model.select();\n\n    this.success(data);\n  }\n}\n"
    ]
}